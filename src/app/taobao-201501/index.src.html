<!-- extend "../../html/layout/layout.base.html" -->

<!-- section "head" -->
<meta name="keywords" content="taobao" />
<meta name="description" content="taobao" />
<title>taobao</title>
<!-- /section -->

<!-- section "body" -->
<script type="text/javascript">
document.write([
	'<link rel="stylesheet" href="' + G.CDN_BASE + '/app/taobao-201501/style/main.css" />'
].join(''));
</script>

<div class="page-wrapper"></div>

<script type="text/javascript">
require(['jquery', 'app', 'skateboard'], function($, app, Skateboard) {
	if(!G.IS_PROTOTYPE) {
		if(!app.cookie.get('wxopenid')) {
			var urlParamOpenId = app.util.getUrlParam('code');
			if(urlParamOpenId) {
				app.cookie.set('wxopenid', urlParamOpenId);
			} else {
				location.href = [
					'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxd4f26aea63a05347&redirect_uri=', 
					encodeURIComponent(location.href.split('#')[0]), 
					'&response_type=code&scope=snsapi_base&state=null'
				].join('');
			}
		}
	}

	//adjust
	var wrapper = $('.page-wrapper');
	ww = $(window).width();
	wrapper.height(ww * 604 / 375);
	$('html').css({
		fontSize: ww / 375 * 100 + '%'
	});

	$.extend(G.MD5_MAP, %{{md5map.taobao-201501}}%);

	var urlParams = app.util.getUrlParams();
	var defaultModName = 'home';
	if(urlParams.home == 'share') {
		if(urlParams.from == 'timeline') {
			defaultModName = 'timeline';
		} else if(urlParams.from == 'singlemessage') {
			defaultModName = 'mom-open';
		} else {
			defaultModName = 'share';
		}
	} else if(urlParams.home == 'momshare') {
		if(urlParams.from == 'timeline') {
			defaultModName = 'mom-timeline';
		} else {
			defaultModName = 'buy-success';
		}
	}
	Skateboard.core.init({
		container: $('.page-wrapper'),
		defaultModName: defaultModName,
		modBase: '../../../app/taobao-201501/script/',
		animate: {
			type: 'fade',
			timingFunction: 'linear',
			duration: 300
		},
		transformAnimation: false,
		isSupportHistoryState: false,
		onBeforeViewChange: function(modName, modInst) {
			app.ajax.hideLoading();
			app.alerts.alert.hide();
			app.alerts.modal.hide();
			if(modName != defaultModName && !G.state.get()) {
				Skateboard.core.view('/view/' + defaultModName, {replaceState: true});
				return false;
			}
		},
		onAfterViewChange: function(modName, modInst) {
			var modClassName = 'body-sb-mod--' + modInst._modName.replace(/\//g, '-');
			var bodyClassName = document.body.className.replace((/\bbody-sb-mod--\S+/), modClassName);
			if((/\bsb-show-nav\b/).test(bodyClassName)) {
				if(!modInst.showNavTab) {
					bodyClassName = bodyClassName.replace((/\s*\bsb-show-nav\b/), '');
				}
			} else if(modInst.showNavTab) {
				bodyClassName = bodyClassName + ' sb-show-nav';
			}
			document.body.className = bodyClassName;
		},
		constructContentDom: function(modName, args, opt) {
			var contentDom = $([
				'<div class="sb-mod sb-mod--' + modName.replace(/\//g, '-') + '" data-sb-mod="' + modName + '" data-sb-scene="0" onscroll="require(\'app\').mod.scroll(this.scrollTop);">',
					'<div class="sb-mod__body">',
						'<div class="body-inner" data-sb-mod-not-renderred>',
						'</div>',
					'</div>',
				'</div>'
			].join('')).prependTo($('.page-wrapper'));
			return contentDom;
		}
	});
}, function() {

});
</script>
<!-- /section -->